
stages:
  - stage: vscode_azure_iot_edge
    displayName: vscode azure iot edge
    jobs:
    - job: Linux
      pool:
        vmImage: ubuntu-latest
      steps:
      - template: vsix-package.yml
      - script: |
<<<<<<< HEAD
           if [ "$TRAVIS_OS_NAME" == "linux" ]; then
              /usr/bin/Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &
              export DISPLAY=':99.0'
              sleep 3
           fi
=======
          Xvfb -ac :99 -screen 0 1280x1024x16 &
          export DISPLAY=:99
>>>>>>> ac4b5cdbbad982b1a526a0411d0046a431178a5a
        displayName: 'Start xvfb'
  
      - script: |
          npm test --silent
        displayName: 'npm test'
        
      - script: |
          docker run -t --rm -v $PWD:/mnt:ro dkhamsing/awesome_bot --white-list "gitter.im/Microsoft/vscode-azure-iot-edge" --allow-dupe --allow-redirect --skip-save-results `ls *.md`
        displayName: 'docker test'
  
      - template: vsix-publish.yml
  
    - job: MacOS
      dependsOn: []
      pool:
        vmImage: macOS-latest
      steps:
      - template: vsix-package.yml
      - script: |
          npm test --verbose
        displayName: 'npm test'
      - template: vsix-publish.yml